<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Dashboard</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body class=""  >
    <div class="wrapper"  ng-app="myApp" ng-controller="MyController">
      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">

        <!-- Main content -->
        <section class="content">
          <!-- Main row -->
          <div class="row">
            <!-- Left col -->
            <div class="col-md-8">
              <div class="row">
                <div class="col-md-6">
                  <!-- DIRECT CHAT -->
                  <div class="box box-warning direct-chat direct-chat-warning">
                    <div class="box-header with-border">
                      <h3 class="box-title">
        <label for="nameInput">Username:</label>
        <input ng-model="name" type="text" id="nameInput" placeholder="enter a username...">
</h3>

                      <div class="box-tools pull-right">
                        <span data-toggle="tooltip" title="3 New Messages" class="badge bg-yellow">3</span>
                        <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
                        <button class="btn btn-box-tool" data-toggle="tooltip" title="Contacts" data-widget="chat-pane-toggle"><i class="fa fa-comments"></i></button>
                        <button class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
                      </div>
                    </div><!-- /.box-header -->
                    <div class="box-body">
                      <!-- Conversations are loaded here -->
                      <div class="direct-chat-messages">
                        <!-- Message. Default to the left -->
                        <!-- Message to the right -->
                        <div xxxclass="direct-chat-msg rightxxx" ng-repeat="msg in messages" ng-class="getClass(msg)" >
                          <div class="direct-chat-info clearfix">
                            <span xxxclass="direct-chat-name pull-right" ng-class="getClassName(msg)" >{{ msg.from }}</span>
                            <span xxxclass="direct-chat-timestamp pull-left" ng-class="getClassTimestamp(msg)">{{ msg.time }}</span>
                          </div><!-- /.direct-chat-info -->
                          <img class="direct-chat-img" src="dist/img/user3-128x128.jpg" alt="message user image"><!-- /.direct-chat-img -->
                          <div class="direct-chat-text">
                            {{ msg.body }}
                          </div><!-- /.direct-chat-text -->
                        </div><!-- /.direct-chat-msg -->


                      </div><!--/.direct-chat-messages-->

                      <!-- Contacts are loaded here -->
                      <div class="direct-chat-contacts">
                        <ul class="contacts-list">
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user1-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  Count Dracula
                                  <small class="contacts-list-date pull-right">2/28/2015</small>
                                </span>
                                <span class="contacts-list-msg">How have you been? I was...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user7-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  Sarah Doe
                                  <small class="contacts-list-date pull-right">2/23/2015</small>
                                </span>
                                <span class="contacts-list-msg">I will be waiting for...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user3-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  Nadia Jolie
                                  <small class="contacts-list-date pull-right">2/20/2015</small>
                                </span>
                                <span class="contacts-list-msg">I'll call you back at...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user5-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  Nora S. Vans
                                  <small class="contacts-list-date pull-right">2/10/2015</small>
                                </span>
                                <span class="contacts-list-msg">Where is your new...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user6-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  John K.
                                  <small class="contacts-list-date pull-right">1/27/2015</small>
                                </span>
                                <span class="contacts-list-msg">Can I take a look at...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                          <li>
                            <a href="#">
                              <img class="contacts-list-img" src="dist/img/user8-128x128.jpg">
                              <div class="contacts-list-info">
                                <span class="contacts-list-name">
                                  Kenneth M.
                                  <small class="contacts-list-date pull-right">1/4/2015</small>
                                </span>
                                <span class="contacts-list-msg">Never mind I found...</span>
                              </div><!-- /.contacts-list-info -->
                            </a>
                          </li><!-- End Contact Item -->
                        </ul><!-- /.contatcts-list -->
                      </div><!-- /.direct-chat-pane -->
                    </div><!-- /.box-body -->
                    <div class="box-footer">
                      <form action="#" method="post">
                        <div class="input-group">
                          <input type="text" name="message" placeholder="Type Message ..." class="form-control" ng-model="msg" ng-keydown="addMessage($event)" type="text" id="messageInput"  >
                          <span class="input-group-btn">
                            <button type="button" class="btn btn-warning btn-flat" ng-click="clickSend()" >Send</button>
                          </span>
                        </div>
                      </form>
                    </div><!-- /.box-footer-->
                  </div><!--/.direct-chat -->
                </div><!-- /.col -->
              </div><!-- /.row -->
            </div><!-- /.col -->
          </div><!-- /.row -->
        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->

    </div><!-- ./wrapper -->
    <script>
      var myApp = angular.module("myApp", ["firebase"]);

      //Get id of tutor and student and get all messages related to them
      var tutorId = null;
      var studentId = null;
      //sort which id is first TODO

      var sortedChatUid = "facebook:10205542375624024_facebook:1129363767081285";

      var ref = new Firebase("https://ubertutoralpha.firebaseio.com/chat/"+sortedChatUid);

      myApp.controller("MyController", ["$scope", "$firebaseArray",
        function($scope, $firebaseArray) {
          //CREATE A FIREBASE REFERENCE

          // GET MESSAGES AS AN ARRAY
          $scope.messages = $firebaseArray(ref);
          $scope.name='asf';
          
          // function loadChat(currUserSnapshot){
          //   //console.log(currUserSnapshot.key());
          //   var ref = new Firebase("https://ubertutoralpha.firebaseio.com/users/"+currUserSnapshot.key()+"/appointmentIDs");

          //   // Attach an asynchronous callback to read the data at our posts reference
          //   ref.on("value", function(snapshot) {
          //     //console.log(snapshot.val());
          //     var userAppointments = currUserSnapshot.val().appointmentIDs;
          //     var allAppointments = snapshot.val();

          //     console.log(userAppointments);
          //     console.log(allAppointments);


          //     //Clear list before showing
          //     $("#bookings").empty();
          //     //Go through every appointment for the user, map it to a real appointment, the display it all
          //     if(userAppointments && allAppointments){
          //       $.each(userAppointments, function(uid, appointmentMapObj){
          //         console.log(uid);
          //         //Get the entire Appointment Obj from Mapping
          //         var ref = new Firebase("https://ubertutoralpha.firebaseio.com/appointments/"+uid);
          //         ref.on("value", function(appointmentSnapshot) {
          //           //Update Actual Bookings on UI
          //           $("#bookings").prepend("<tr><td><a style='font-size:10px' href="+"TBA-TODO"+">"+uid+"</a></td><td>"+appointmentSnapshot.val().courses+"</td><td><span class='label label-info'>"+appointmentSnapshot.val().status+"</span></td><td><div class='sparkbar' data-color='#00a65a' data-height='20'>"+appointmentSnapshot.val().tutorDisplayName+"</div></td></tr>");

          //         },function (errorObject) {
          //           console.log("The read failed: " + errorObject.code);
          //         });
          //       });
          //     } else{
          //       $("#bookings").prepend("<tr><td>"+"Empty"+"</td><td>"+"</td><td><span class='label label-info'>"+"</span></td><td><div class='sparkbar' data-color='#00a65a' data-height='20'>"+"<a href="+"/STUDENT/index.html"+">"+"Find A Tutor"+"</a>"+"</div></td></tr>");
          //     }
          //   }, function (errorObject) {
          //     console.log("The read failed: " + errorObject.code);
          //   });
          // }
          
          function addmsg(){
              //ALLOW CUSTOM OR ANONYMOUS USER NAMES
              var name = $scope.name || "anonymous";

              //ADD TO FIREBASE
              $scope.messages.$add({
                from: name,
                to: name,
                messageDirection: "left",//left or right
                body: $scope.msg,
                time: 123,  //moment().parse(HH MM SS);
              }).then(function(ref){
                console.log(ref.key());
              });

              //console.log("TEST: ", test);

              //RESET MESSAGE
              $scope.msg = "";          
          };
          
          //ADD MESSAGE METHOD
          $scope.addMessage = function(e) {
            //LISTEN FOR RETURN KEY
            if (e.keyCode === 13 && $scope.msg) {
                addmsg();
            }
            return true;
          };
          
          $scope.clickSend = function(e) {
            console.log('clickSend');
            //LISTEN FOR CLICK
            if ( $scope.msg) {
                addmsg();
            }
          };
          
          var auth="ff";
          $scope.getClass=function(msg){
            if(msg.from===auth){
                return "direct-chat-msg rightxxx right";
            }
            return "direct-chat-msg";
          };
          $scope.getClassName=function(msg){
            if(msg.from===auth){
                return "direct-chat-name pull-right";
            }
            return "direct-chat-name pull-left";
          };
          $scope.getClassTimestamp=function(msg){
            if(msg.from===auth){
                return "direct-chat-timestamp pull-left";
            }
            return "direct-chat-timestamp pull-right";
          };
        }
      ]);
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/1.0.0/angularfire.min.js"></script>
    <!-- jQuery 2.1.4 -->
    <script src="plugins/jQuery/jQuery-2.1.4.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="plugins/fastclick/fastclick.min.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/app.min.js"></script>
    <!-- SlimScroll 1.3.0 -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
	
	

	
	
	
	
	
	
	
  </body>
</html>
